<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com/ https://cdn.jsdelivr.net/; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; object-src 'none'; media-src 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=(), usb=(), autoplay=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=63072000; includeSubDomains; preload">
    
    <title>Генератор ТЗ - TechPortal</title>
    <meta name="description" content="Бесплатный генератор технических заданий для веб-проектов">
    
    <!-- Иконки -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon-192.svg">
    
    <!-- PWA манифест -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TechPortal">
    
    <!-- Шрифты -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Стили -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        :root {
            /* Используем те же переменные, что и в основном сайте */
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-bg-tertiary: rgba(30, 41, 59, 0.7);
            --color-bg-card: rgba(30, 41, 59, 0.8);
            --color-bg-card-hover: rgba(51, 65, 85, 0.8);
            
            --color-text-primary: #f8fafc;
            --color-text-secondary: #cbd5e1;
            --color-text-tertiary: #94a3b8;
            
            --color-primary: #3b82f6;
            --color-secondary: #8b5cf6;
            --color-accent: #10b981;
            
            --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6);
            --gradient-secondary: linear-gradient(135deg, #8b5cf6, #ec4899);
            --gradient-accent: linear-gradient(135deg, #10b981, #3b82f6);
            
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-size-5xl: 3rem;
            --font-size-6xl: 3.75rem;
            
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 0.75rem;
            --spacing-lg: 1rem;
            --spacing-xl: 1.5rem;
            --spacing-2xl: 2rem;
            --spacing-3xl: 3rem;
            --spacing-4xl: 4rem;
            
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 10px 25px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 15px rgba(59, 130, 246, 0.5);
            
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            
            --z-toast: 9000;
            --z-modal: 8000;
            --z-nav: 7000;
            --z-dropdown: 6000;
            --z-header: 5000;
        }
        
        .tz-generator {
            min-height: 100vh;
            background-color: var(--color-bg-primary);
            padding: 2rem 0;
            position: relative;
        }
        
        .tz-generator::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .tz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            position: relative;
            z-index: 1;
        }
        
        .tz-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
            color: var(--color-text-primary);
        }
        
        .tz-title {
            font-size: var(--font-size-4xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tz-subtitle {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            opacity: 0.9;
        }
        
        .tz-card {
            background: var(--color-bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-2xl);
            box-shadow: var(--shadow-lg);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            margin-bottom: var(--spacing-2xl);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
            width: 0%;
            box-shadow: var(--shadow-glow);
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .step-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--color-text-primary);
        }
        
        .form-group {
            margin-bottom: var(--spacing-lg);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--color-text-primary);
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-normal);
            box-sizing: border-box;
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
        }
        
        .form-input:focus, .form-textarea:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        .form-select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-xl) var(--spacing-md) var(--spacing-md);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-normal);
            box-sizing: border-box;
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: 
                linear-gradient(45deg, transparent 50%, var(--color-primary) 50%),
                linear-gradient(135deg, var(--color-primary) 50%, transparent 50%);
            background-position: 
                calc(100% - 20px) calc(1em + 2px),
                calc(100% - 15px) calc(1em + 2px);
            background-size: 
                5px 5px,
                5px 5px;
            background-repeat: no-repeat;
        }
        
        .form-select:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        
        .form-check-input {
            margin-right: var(--spacing-sm);
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
        }
        
        .btn-primary, .btn-secondary {
            padding: var(--spacing-sm) var(--spacing-xl);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: var(--color-text-primary);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .btn-primary:hover::before {
            opacity: 1;
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }
        
        .btn-secondary:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .btn-icon {
            width: 20px;
            height: 20px;
        }
        
        .result-section {
            margin-top: var(--spacing-2xl);
        }
        
        .result-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--color-bg-tertiary);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .logo {
            font-size: var(--font-size-xl);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--color-text-primary);
            text-decoration: none;
        }
        
        .logo span {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @media (max-width: 768px) {
            .tz-title {
                font-size: var(--font-size-3xl);
            }
            
            .tz-card {
                padding: var(--spacing-xl);
            }
            
            .form-actions {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .tz-title {
                font-size: var(--font-size-2xl);
            }
            
            .tz-subtitle {
                font-size: var(--font-size-base);
            }
        }

        /* Стили прелоадера */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-bg-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .preloader-content {
            text-align: center;
        }

        .preloader-logo {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .preloader-spinner svg {
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        .preloader-spinner circle {
            fill: none;
            stroke: var(--color-primary);
            stroke-width: 5;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 75;
            transform-origin: 50% 50%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Прелоадер -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">
                <span class="gradient-text">TP</span>
            </div>
            <div class="preloader-spinner">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Курсор -->
    <div class="custom-cursor" id="customCursor"></div>
    <div class="custom-cursor-follower" id="customCursorFollower"></div>

    <!-- Линии фона -->
    <div class="background-lines">
        <div class="line line-1"></div>
        <div class="line line-2"></div>
        <div class="line line-3"></div>
    </div>

    <!-- Прогресс скролла -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Шапка сайта -->
    <div class="site-header">
        <a href="index.html" class="logo">
            <span>TP</span> TechPortal
        </a>
        <a href="index.html" class="btn btn-secondary">
            <span>Вернуться на сайт</span>
        </a>
    </div>

    <!-- Контент страницы -->
    <div class="tz-generator">
        <div class="tz-container">
            <div class="tz-header">
                <h1 class="tz-title">Генератор технического задания</h1>
                <p class="tz-subtitle">Создайте профессиональное ТЗ для вашего веб-проекта за 5 минут</p>
            </div>
            
            <!-- Остальное содержимое страницы -->
            <div class="tz-card">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-status">
                    Шаг <span id="currentStep">1</span> из <span id="totalSteps">6</span>
                </div>
            </div>
            
            <div class="tz-card">
                <div class="step active" id="step1">
                    <h2 class="step-title">1. Какой тип проекта планируете?</h2>
                    <div class="option-grid">
                        <div class="option-card" data-value="landing">
                            <div class="option-icon">🌐</div>
                            <div class="option-title">Лендинг</div>
                            <div class="option-desc">Одностраничный сайт для продажи товара/услуги</div>
                        </div>
                        <div class="option-card" data-value="website">
                            <div class="option-icon">📱</div>
                            <div class="option-title">Многостраничный сайт</div>
                            <div class="option-desc">Корпоративный сайт, блог, портфолио</div>
                        </div>
                        <div class="option-card" data-value="shop">
                            <div class="option-icon">🛒</div>
                            <div class="option-title">Интернет-магазин</div>
                            <div class="option-desc">E-commerce с каталогом и корзиной</div>
                        </div>
                        <div class="option-card" data-value="app">
                            <div class="option-icon">⚙️</div>
                            <div class="option-title">Веб-приложение</div>
                            <div class="option-desc">CRM, система управления, платформа</div>
                        </div>
                    </div>
                </div>
                
                <div class="step" id="step2">
                    <h2 class="step-title">2. Расскажите о своем проекте</h2>
                    <div class="form-group">
                        <label class="form-label">Название проекта *</label>
                        <input type="text" class="form-input" id="projectName" placeholder="Например: Интернет-магазин одежды" required minlength="3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Описание проекта *</label>
                        <textarea class="form-textarea" id="projectDescription" placeholder="Опишите что должен делать сайт, какие задачи решать, кто ваша аудитория..." required minlength="10"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ссылки на конкурентов (необязательно)</label>
                        <textarea class="form-textarea" id="competitors" placeholder="Перечислите сайты конкурентов или примеры, которые вам нравятся"></textarea>
                    </div>
                </div>
                
                <div class="step" id="step3">
                    <h2 class="step-title">3. Кто ваша целевая аудитория?</h2>
                    <div class="form-group">
                        <label class="form-label">Возраст аудитории *</label>
                        <select class="form-select" id="targetAge">
                            <option value="">Выберите возрастную группу</option>
                            <option value="18-25">18-25 лет (студенты, молодые специалисты)</option>
                            <option value="25-35">25-35 лет (молодые семьи, карьеристы)</option>
                            <option value="35-45">35-45 лет (среднего возраста, устоявшиеся)</option>
                            <option value="45+">45+ лет (зрелая аудитория)</option>
                            <option value="mixed">Смешанная аудитория</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Уровень технической грамотности *</label>
                        <select class="form-select" id="techLevel">
                            <option value="">Выберите уровень</option>
                            <option value="low">Низкий (простой интерфейс, минимум функций)</option>
                            <option value="medium">Средний (стандартный функционал)</option>
                            <option value="high">Высокий (сложные функции, много возможностей)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Основные потребности пользователей</label>
                        <textarea class="form-textarea" id="userNeeds" placeholder="Что пользователи хотят получить от сайта? Какие проблемы решить?"></textarea>
                    </div>
                </div>
                
                <div class="step" id="step4">
                    <h2 class="step-title">4. Какой функционал нужен?</h2>
                    <p style="margin-bottom: 1rem; color: #666;">Отметьте нужные функции:</p>
                    <div class="checkbox-group" id="functionalityList">
                        <div class="checkbox-item">
                            <input type="checkbox" id="responsive" value="responsive">
                            <label for="responsive">Адаптивная верстка (мобильные)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="seo" value="seo">
                            <label for="seo">SEO оптимизация</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analytics" value="analytics">
                            <label for="analytics">Счетчики аналитики</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="contact-form" value="contact-form">
                            <label for="contact-form">Форма обратной связи</label>
                        </div>
                    </div>
                </div>
                
                <div class="step" id="step5">
                    <h2 class="step-title">5. Дизайн и технические требования</h2>
                    <div class="form-group">
                        <label class="form-label">Стиль дизайна *</label>
                        <select class="form-select" id="designStyle">
                            <option value="">Выберите стиль</option>
                            <option value="modern">Современный (минимализм, чистые линии)</option>
                            <option value="corporate">Корпоративный (строгий, деловой)</option>
                            <option value="creative">Креативный (яркий, необычный)</option>
                            <option value="classic">Классический (традиционный, консервативный)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Цветовые предпочтения</label>
                        <input type="text" class="form-input" id="colorPrefs" placeholder="Например: синий, белый, корпоративные цвета">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Есть ли логотип и фирменный стиль?</label>
                        <select class="form-select" id="branding">
                            <option value="">Выберите вариант</option>
                            <option value="yes">Да, есть готовый фирменный стиль</option>
                            <option value="partial">Есть логотип, но нет фирменного стиля</option>
                            <option value="no">Нет, нужно создать с нуля</option>
                        </select>
                    </div>
                </div>
                
                <div class="step" id="step6">
                    <h2 class="step-title">6. Бюджет и временные рамки</h2>
                    <div class="form-group">
                        <label class="form-label">Планируемый бюджет *</label>
                        <select class="form-select" id="budget">
                            <option value="">Выберите диапазон</option>
                            <option value="small">50€ - 150€ (простой проект)</option>
                            <option value="medium">150€ - 400€ (средний проект)</option>
                            <option value="large">400€ - 800€ (сложный проект)</option>
                            <option value="enterprise">800€+ (корпоративный уровень)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Когда нужно завершить проект? *</label>
                        <select class="form-select" id="deadline">
                            <option value="">Выберите срок</option>
                            <option value="urgent">Срочно (1-2 недели)</option>
                            <option value="normal">Стандартно (1-2 месяца)</option>
                            <option value="relaxed">Без спешки (2-3 месяца)</option>
                            <option value="flexible">Гибкие сроки</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Дополнительные требования</label>
                        <textarea class="form-textarea" id="additionalReqs" placeholder="Особые пожелания, ограничения, важные детали..."></textarea>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">Назад</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Далее</button>
                </div>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="tz-card">
                    <h2 style="text-align: center; margin-bottom: 2rem;">✅ Ваше техническое задание готово!</h2>
                    
                    <div class="tz-preview" id="tzPreview">
                        <!-- Generated TZ content will be here -->
                    </div>
                    
                    <div class="tz-export">
                        <div class="export-buttons">
                            <button class="btn btn-primary" onclick="downloadPDF()">📄 Скачать PDF</button>
                            <button class="btn btn-secondary" onclick="copyToClipboard()">📋 Копировать текст</button>
                            <button class="btn btn-secondary" onclick="startOver()">🔄 Создать новое ТЗ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let jsPDFLoaded = false;
        
        function loadJsPDF() {
            return new Promise((resolve, reject) => {
                if (jsPDFLoaded) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = () => {
                    jsPDFLoaded = true;
                    resolve();
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        const PRICING_CONFIG = {
            projectTypes: {
                'landing': { min: 50, max: 150, name: 'Лендинг' },
                'website': { min: 100, max: 300, name: 'Многостраничный сайт' },
                'shop': { min: 200, max: 500, name: 'Интернет-магазин' },
                'app': { min: 300, max: 800, name: 'Веб-приложение' }
            },
            
            features: {
                'admin': { cost: 25, name: 'Админ-панель' },
                'auth': { cost: 20, name: 'Авторизация' },
                'api': { cost: 25, name: 'API интеграция' },
                'seo': { cost: 25, name: 'SEO оптимизация' },
                'responsive': { cost: 0, name: 'Адаптивная верстка' },
                'analytics': { cost: 10, name: 'Системы аналитики' },
                'contact-form': { cost: 5, name: 'Форма обратной связи' }
            },
            
            budgetRanges: {
                'small': '50€ - 150€',
                'medium': '150€ - 400€', 
                'large': '400€ - 800€',
                'enterprise': '800€+'
            },
            
            calculateProjectCost: function(projectType, features = []) {
                let baseCost = this.projectTypes[projectType]?.min || 0;
                let additionalCost = features.reduce((sum, feature) => {
                    return sum + (this.features[feature]?.cost || 0);
                }, 0);
                return baseCost + additionalCost;
            },
            
            getBudgetRange: function(totalCost) {
                if (totalCost <= 150) return 'small';
                if (totalCost <= 400) return 'medium';
                if (totalCost <= 800) return 'large';
                return 'enterprise';
            }
        };

        if (typeof window.jspdf === 'undefined') {
            console.warn('jsPDF не загружен, PDF экспорт недоступен');
        }
    </script>
    <script>
        let currentStepIndex = 1;
        const totalSteps = 6;
        const formData = {};
        
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updateFunctionalityBasedOnType();
            initializeFormEffects();
        });
        
        function initializeFormEffects() {
            const selects = document.querySelectorAll('.form-select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    this.classList.add('loading');
                    setTimeout(() => {
                        this.classList.remove('loading');
                    }, 500);
                    
                    this.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
                
                select.addEventListener('focus', function() {
                    this.style.boxShadow = '0 0 30px rgba(102, 126, 234, 0.6)';
                });
                
                select.addEventListener('blur', function() {
                    this.style.boxShadow = '';
                });
            });
            
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('focused');
                });
                
                input.addEventListener('input', function() {
                    this.style.borderColor = 'var(--accent-primary)';
                    clearTimeout(this.timer);
                    this.timer = setTimeout(() => {
                        this.style.borderColor = '';
                        validateField(this);
                    }, 300);
                });
            });
        }
        
        function validateField(field) {
            field.classList.remove('valid', 'invalid');
            
            if (field.hasAttribute('required')) {
                if (field.value.trim() === '') {
                    field.classList.add('invalid');
                    return false;
                }
            }
            
            if (field.type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (field.value && !emailRegex.test(field.value)) {
                    field.classList.add('invalid');
                    return false;
                }
            }
            
            if (field.minLength && field.value.length > 0 && field.value.length < field.minLength) {
                field.classList.add('invalid');
                return false;
            }
            
            if (field.value.trim() !== '') {
                field.classList.add('valid');
            }
            
            return true;
        }
        
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStepIndex < totalSteps) {
                    document.getElementById(`step${currentStepIndex}`).classList.remove('active');
                    currentStepIndex++;
                    document.getElementById(`step${currentStepIndex}`).classList.add('active');
                    updateProgress();
                    updateNavigation();
                    
                    if (currentStepIndex === 4) {
                        updateFunctionalityBasedOnType();
                    }
                } else {
                    generateTZ();
                }
            }
        }
        
        function previousStep() {
            if (currentStepIndex > 1) {
                document.getElementById(`step${currentStepIndex}`).classList.remove('active');
                currentStepIndex--;
                document.getElementById(`step${currentStepIndex}`).classList.add('active');
                updateProgress();
                updateNavigation();
            }
        }
        
        function updateProgress() {
            const progress = (currentStepIndex / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStepIndex;
            document.getElementById('totalSteps').textContent = totalSteps;
        }
        
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentStepIndex > 1 ? 'block' : 'none';
            nextBtn.textContent = currentStepIndex === totalSteps ? 'Создать ТЗ' : 'Далее';
        }
        
        function validateCurrentStep() {
            switch(currentStepIndex) {
                case 1:
                    const projectType = document.querySelector('.option-card.selected');
                    if (!projectType) {
                        alert('Выберите тип проекта');
                        return false;
                    }
                    formData.projectType = projectType.dataset.value;
                    break;
                    
                case 2:
                    const name = document.getElementById('projectName').value.trim();
                    const desc = document.getElementById('projectDescription').value.trim();
                    if (!name || !desc) {
                        alert('Заполните название и описание проекта');
                        return false;
                    }
                    formData.projectName = name;
                    formData.projectDescription = desc;
                    formData.competitors = document.getElementById('competitors').value.trim();
                    break;
                    
                case 3:
                    const age = document.getElementById('targetAge').value;
                    const tech = document.getElementById('techLevel').value;
                    if (!age || !tech) {
                        alert('Укажите возраст и технический уровень аудитории');
                        return false;
                    }
                    formData.targetAge = age;
                    formData.techLevel = tech;
                    formData.userNeeds = document.getElementById('userNeeds').value.trim();
                    break;
                    
                case 4:
                    const features = [];
                    document.querySelectorAll('#functionalityList input:checked').forEach(cb => {
                        features.push(cb.value);
                    });
                    formData.features = features;
                    break;
                    
                case 5:
                    const style = document.getElementById('designStyle').value;
                    if (!style) {
                        alert('Выберите стиль дизайна');
                        return false;
                    }
                    formData.designStyle = style;
                    formData.colorPrefs = document.getElementById('colorPrefs').value.trim();
                    formData.branding = document.getElementById('branding').value;
                    break;
                    
                case 6:
                    const budget = document.getElementById('budget').value;
                    const deadline = document.getElementById('deadline').value;
                    if (!budget || !deadline) {
                        alert('Укажите бюджет и сроки');
                        return false;
                    }
                    formData.budget = budget;
                    formData.deadline = deadline;
                    formData.additionalReqs = document.getElementById('additionalReqs').value.trim();
                    break;
            }
            return true;
        }
        
        document.addEventListener('click', function(e) {
            if (e.target.closest('.option-card')) {
                const card = e.target.closest('.option-card');
                const container = card.parentElement;
                container.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            }
        });
        
        function updateFunctionalityBasedOnType() {
            const functionalityList = document.getElementById('functionalityList');
            const projectType = formData.projectType;
            
            const baseCheckboxes = functionalityList.innerHTML;
            
            let additionalFeatures = [];
            
            switch(projectType) {
                case 'landing':
                    additionalFeatures = [
                        {id: 'animations', value: 'animations', label: 'Анимации и параллакс'},
                        {id: 'popup', value: 'popup', label: 'Всплывающие окна'},
                        {id: 'countdown', value: 'countdown', label: 'Таймер обратного отсчета'},
                        {id: 'testimonials', value: 'testimonials', label: 'Отзывы клиентов'}
                    ];
                    break;
                case 'website':
                    additionalFeatures = [
                        {id: 'blog', value: 'blog', label: 'Блог/новости'},
                        {id: 'gallery', value: 'gallery', label: 'Галерея изображений'},
                        {id: 'multilang', value: 'multilang', label: 'Многоязычность'},
                        {id: 'search', value: 'search', label: 'Поиск по сайту'}
                    ];
                    break;
                case 'shop':
                    additionalFeatures = [
                        {id: 'catalog', value: 'catalog', label: 'Каталог товаров'},
                        {id: 'cart', value: 'cart', label: 'Корзина покупок'},
                        {id: 'payment', value: 'payment', label: 'Система оплаты'},
                        {id: 'orders', value: 'orders', label: 'Управление заказами'},
                        {id: 'inventory', value: 'inventory', label: 'Учет остатков'}
                    ];
                    break;
                case 'app':
                    additionalFeatures = [
                        {id: 'auth', value: 'auth', label: 'Авторизация пользователей'},
                        {id: 'admin', value: 'admin', label: 'Админ панель'},
                        {id: 'dashboard', value: 'dashboard', label: 'Дашборд с графиками'},
                        {id: 'api', value: 'api', label: 'API для интеграций'},
                        {id: 'notifications', value: 'notifications', label: 'Уведомления'}
                    ];
                    break;
            }
            
            functionalityList.innerHTML = baseCheckboxes + additionalFeatures.map(feature => `
                <div class="checkbox-item">
                    <input type="checkbox" id="${feature.id}" value="${feature.value}">
                    <label for="${feature.id}">${feature.label}</label>
                </div>
            `).join('');
        }
        
        function generateTZ() {
            const tzHtml = generateTZContent();
            document.getElementById('tzPreview').innerHTML = tzHtml;
            
            document.querySelector('.tz-card').style.display = 'none';
            document.getElementById('resultSection').classList.add('active');
        }
        
        function generateTZContent() {
            const projectTypes = {
                'landing': 'Лендинг-страница',
                'website': 'Многостраничный сайт',
                'shop': 'Интернет-магазин',
                'app': 'Веб-приложение'
            };
            
            const designStyles = {
                'modern': 'Современный минимализм',
                'corporate': 'Корпоративный стиль',
                'creative': 'Креативный дизайн',
                'classic': 'Классический стиль'
            };
            
            const budgetRanges = PRICING_CONFIG.budgetRanges;
            
            return `
                <h1 style="color: var(--text-primary); border-bottom: 2px solid var(--accent-primary); padding-bottom: 1rem;">
                    Техническое задание: ${formData.projectName}
                </h1>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">1. Общая информация</h2>
                <p><strong>Тип проекта:</strong> ${projectTypes[formData.projectType]}</p>
                <p><strong>Описание:</strong> ${formData.projectDescription}</p>
                ${formData.competitors ? `<p><strong>Конкуренты/примеры:</strong> ${formData.competitors}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">2. Целевая аудитория</h2>
                <p><strong>Возраст:</strong> ${formData.targetAge}</p>
                <p><strong>Технический уровень:</strong> ${formData.techLevel}</p>
                ${formData.userNeeds ? `<p><strong>Потребности пользователей:</strong> ${formData.userNeeds}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">3. Функциональные требования</h2>
                <ul>
                    ${formData.features.map(feature => `<li>${getFeatureName(feature)}</li>`).join('')}
                </ul>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">4. Дизайн-требования</h2>
                <p><strong>Стиль:</strong> ${designStyles[formData.designStyle]}</p>
                ${formData.colorPrefs ? `<p><strong>Цветовые предпочтения:</strong> ${formData.colorPrefs}</p>` : ''}
                ${formData.branding ? `<p><strong>Фирменный стиль:</strong> ${getBrandingText(formData.branding)}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">5. Технические требования</h2>
                <ul>
                    <li>Адаптивная верстка для всех устройств</li>
                    <li>Кроссбраузерная совместимость</li>
                    <li>Оптимизация скорости загрузки</li>
                    <li>SEO-оптимизация</li>
                    <li>Безопасность и защита данных</li>
                </ul>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">6. Бюджет и сроки</h2>
                <p><strong>Планируемый бюджет:</strong> ${budgetRanges[formData.budget]}</p>
                <p><strong>Расчетная стоимость:</strong> ${PRICING_CONFIG.calculateProjectCost(formData.projectType, formData.features)}€ (базовая цена без дополнительных сложностей)</p>
                <div style="margin: 1rem 0; padding: 1rem; background: rgba(102, 126, 234, 0.1); border-radius: 8px; font-size: 0.9rem;">
                    <strong>Расчет:</strong> Базовая стоимость ${PRICING_CONFIG.projectTypes[formData.projectType]?.name}: ${PRICING_CONFIG.projectTypes[formData.projectType]?.min}€${formData.features.length > 0 ? ' + дополнительные функции: ' + formData.features.map(f => PRICING_CONFIG.features[f]?.cost || 0).filter(c => c > 0).join('€ + ') + '€' : ''}
                </div>
                <p><strong>Сроки:</strong> ${getDeadlineText(formData.deadline)}</p>
                ${formData.additionalReqs ? `<p><strong>Дополнительные требования:</strong> ${formData.additionalReqs}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">7. Результат</h2>
                <p>По итогам работы заказчик получит:</p>
                <ul>
                    <li>Полностью готовый к работе ${projectTypes[formData.projectType].toLowerCase()}</li>
                    <li>Исходный код проекта</li>
                    <li>Документацию по управлению</li>
                    <li>Техническую поддержку в течение месяца</li>
                </ul>
                
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-primary);">
                    <p style="margin: 0;"><strong>Документ создан:</strong> ${new Date().toLocaleDateString('ru-RU')}</p>
                    <p style="margin: 0;"><strong>Генератор ТЗ:</strong> TechPortal</p>
                </div>
            `;
        }
        
        function getFeatureName(feature) {
            const extendedNames = {
                'animations': 'Анимации и параллакс эффекты',
                'popup': 'Всплывающие окна',
                'countdown': 'Таймер обратного отсчета',
                'testimonials': 'Система отзывов',
                'blog': 'Блог/система новостей',
                'gallery': 'Галерея изображений',
                'multilang': 'Многоязычная поддержка',
                'search': 'Поиск по сайту',
                'catalog': 'Каталог товаров',
                'cart': 'Корзина покупок',
                'payment': 'Система онлайн-оплаты',
                'orders': 'Управление заказами',
                'inventory': 'Система учета остатков',
                'dashboard': 'Дашборд с аналитикой',
                'notifications': 'Система уведомлений'
            };
            
            return PRICING_CONFIG.features[feature]?.name || extendedNames[feature] || feature;
        }
        
        function getBrandingText(branding) {
            const texts = {
                'yes': 'Есть готовый фирменный стиль',
                'partial': 'Есть логотип, нужно доработать фирменный стиль',
                'no': 'Нужно создать с нуля'
            };
            return texts[branding] || branding;
        }
        
        function getDeadlineText(deadline) {
            const texts = {
                'urgent': 'Срочно (1-2 недели)',
                'normal': 'Стандартные сроки (1-2 месяца)',
                'relaxed': 'Без спешки (2-3 месяца)',
                'flexible': 'Гибкие сроки'
            };
            return texts[deadline] || deadline;
        }
        
        async function downloadPDF() {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '⏳ Загружаем PDF...';
            btn.disabled = true;
            
            try {
                await loadJsPDF();
                
                if (typeof window.jspdf === 'undefined') {
                    throw new Error('jsPDF не загружен');
                }
            } catch (error) {
                alert('Ошибка загрузки PDF библиотеки. Попробуйте скопировать текст.');
                btn.textContent = originalText;
                btn.disabled = false;
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            
            let yPosition = 20;
            const lineHeight = 7;
            const pageHeight = 280;
            
            doc.setFontSize(16);
            doc.text(`Техническое задание: ${formData.projectName}`, 20, yPosition);
            yPosition += lineHeight * 2;
            
            const content = [
                {
                    title: '1. Общая информация',
                    items: [
                        `Тип проекта: ${getProjectTypeName(formData.projectType)}`,
                        `Описание: ${formData.projectDescription}`,
                        formData.competitors ? `Конкуренты: ${formData.competitors}` : null
                    ]
                },
                {
                    title: '2. Целевая аудитория',
                    items: [
                        `Возраст: ${formData.targetAge}`,
                        `Технический уровень: ${formData.techLevel}`,
                        formData.userNeeds ? `Потребности: ${formData.userNeeds}` : null
                    ]
                },
                {
                    title: '3. Функциональность',
                    items: formData.features.map(f => getFeatureName(f))
                },
                {
                    title: '4. Дизайн',
                    items: [
                        `Стиль: ${getDesignStyleName(formData.designStyle)}`,
                        formData.colorPrefs ? `Цвета: ${formData.colorPrefs}` : null,
                        formData.branding ? `Фирменный стиль: ${getBrandingText(formData.branding)}` : null
                    ]
                },
                {
                    title: '5. Бюджет и сроки',
                    items: [
                        `Бюджет: ${getBudgetText(formData.budget)}`,
                        `Сроки: ${getDeadlineText(formData.deadline)}`,
                        formData.additionalReqs ? `Дополнительно: ${formData.additionalReqs}` : null
                    ]
                }
            ];
            
            doc.setFontSize(12);
            
            content.forEach(section => {
                if (yPosition > pageHeight - 40) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFont('helvetica', 'bold');
                doc.text(section.title, 20, yPosition);
                yPosition += lineHeight;
                
                doc.setFont('helvetica', 'normal');
                section.items.forEach(item => {
                    if (item) {
                        const splitText = doc.splitTextToSize(item, 170);
                        splitText.forEach(line => {
                            if (yPosition > pageHeight - 20) {
                                doc.addPage();
                                yPosition = 20;
                            }
                            doc.text(line, 25, yPosition);
                            yPosition += lineHeight;
                        });
                    }
                });
                yPosition += lineHeight;
            });
            
            // Save PDF
            doc.save(`TZ_${formData.projectName.replace(/[^a-zа-я0-9]/gi, '_')}.pdf`);
            
            // Восстанавливаем кнопку
            btn.textContent = originalText;
            btn.disabled = false;
        }
        
        function copyToClipboard() {
            const tzText = document.getElementById('tzPreview').innerText;
            navigator.clipboard.writeText(tzText).then(() => {
                alert('Техническое задание скопировано в буфер обмена!');
            }).catch(() => {
                alert('Ошибка копирования. Попробуйте выделить текст вручную.');
            });
        }
        
        function startOver() {
            if (confirm('Вы уверены, что хотите создать новое ТЗ? Текущий прогресс будет потерян.')) {
                location.reload();
            }
        }
        
        // Helper functions for PDF
        function getProjectTypeName(type) {
            return PRICING_CONFIG.projectTypes[type]?.name || type;
        }
        
        function getDesignStyleName(style) {
            const styles = {
                'modern': 'Современный минимализм',
                'corporate': 'Корпоративный стиль',
                'creative': 'Креативный дизайн',
                'classic': 'Классический стиль'
            };
            return styles[style] || style;
        }
        
        function getBudgetText(budget) {
            return PRICING_CONFIG.budgetRanges[budget] || budget;
        }
    </script>

    <script>
        // Скрытие прелоадера
        window.addEventListener('load', function() {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.classList.add('hidden');
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 500);
            }
        });

        // Запасной вариант, если событие load не сработает
        setTimeout(() => {
            const preloader = document.getElementById('preloader');
            if (preloader && !preloader.classList.contains('hidden')) {
                preloader.classList.add('hidden');
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 500);
            }
        }, 5000);
    </script>
</body>
</html> 
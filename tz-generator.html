<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Генератор ТЗ - TechPortal</title>
    <meta name="description" content="Бесплатный генератор технических заданий для веб-проектов">
    
    <!-- Стили -->
    <link rel="stylesheet" href="css/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    
    <style>
        /* Import same variables as main site */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --border-color: #333333;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .tz-generator {
            min-height: 100vh;
            background: var(--bg-primary);
            padding: 2rem 0;
            position: relative;
        }
        
        .tz-generator::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(102, 126, 234, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .tz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
            position: relative;
            z-index: 1;
        }
        
        .tz-header {
            text-align: center;
            margin-bottom: 3rem;
            color: var(--text-primary);
        }
        
        .tz-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tz-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            opacity: 0.9;
        }
        
        .tz-card {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .step-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background: rgba(26, 26, 26, 0.8);
            color: var(--text-primary);
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(42, 42, 42, 0.9) 100%);
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: 
                linear-gradient(45deg, transparent 50%, var(--accent-primary) 50%),
                linear-gradient(135deg, var(--accent-primary) 50%, transparent 50%),
                linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(42, 42, 42, 0.9) 100%);
            background-position: 
                calc(100% - 20px) calc(1em + 2px),
                calc(100% - 15px) calc(1em + 2px),
                100% 0;
            background-size: 
                5px 5px,
                5px 5px,
                100% 100%;
            background-repeat: no-repeat;
            position: relative;
        }
        
        .form-select:hover {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
            background: rgba(26, 26, 26, 1);
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            background-image: 
                linear-gradient(45deg, transparent 50%, #ffffff 50%),
                linear-gradient(135deg, #ffffff 50%, transparent 50%),
                linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            background-position: 
                calc(100% - 20px) calc(1em + 2px),
                calc(100% - 15px) calc(1em + 2px),
                100% 0;
            background-size: 
                5px 5px,
                5px 5px,
                100% 100%;
            background-repeat: no-repeat;
        }
        
        /* Стилизация опций select */
        .form-select option {
            background: rgba(26, 26, 26, 0.95);
            color: var(--text-primary);
            padding: 0.5rem;
            border: none;
        }
        
        .form-select option:hover,
        .form-select option:checked {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .option-card {
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: rgba(26, 26, 26, 0.5);
            color: var(--text-primary);
        }
        
        .option-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            background: rgba(26, 26, 26, 0.8);
        }
        
        .option-card.selected {
            border-color: var(--accent-primary);
            background: rgba(102, 126, 234, 0.15);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .option-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .option-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .checkbox-item input {
            margin-right: 0.5rem;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(26, 26, 26, 0.8);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: rgba(26, 26, 26, 1);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .result-section {
            display: none;
        }
        
        .result-section.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        
        .tz-preview {
            background: rgba(26, 26, 26, 0.8);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .tz-export {
            text-align: center;
            margin-top: 2rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Дополнительные эффекты для select */
        .form-group {
            position: relative;
        }
        
        .form-group::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            border-radius: 1px;
        }
        
        .form-group:focus-within::after {
            transform: scaleX(1);
        }
        
        /* Анимация загрузки для select при изменении */
        .form-select.loading {
            position: relative;
            pointer-events: none;
        }
        
        .form-select.loading::before {
            content: '';
            position: absolute;
            top: 50%;
            right: 15px;
            width: 16px;
            height: 16px;
            border: 2px solid var(--accent-primary);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translateY(-50%);
        }
        
        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }
        
        /* Пульсирующий эффект при фокусе */
        .form-group.focused {
            position: relative;
        }
        
        .form-group.focused::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 12px;
            opacity: 0.3;
            animation: pulse 2s infinite;
            z-index: -1;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.02);
                opacity: 0.1;
            }
            100% {
                transform: scale(1);
                opacity: 0.3;
            }
        }
        
        /* Улучшенный градиент для select в активном состоянии */
        .form-select:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
        }
        
        /* Гладкий переход между состояниями */
        .form-select, .form-input, .form-textarea {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Эффект свечения при валидации */
        .form-input.valid, .form-textarea.valid, .form-select.valid {
            border-color: #4ade80;
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.3);
        }
        
        .form-input.invalid, .form-textarea.invalid, .form-select.invalid {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @media (max-width: 768px) {
            .tz-title {
                font-size: 2rem;
            }
            
            .tz-card {
                padding: 1.5rem;
            }
            
            .option-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .form-select {
                padding: 1rem 2.5rem 1rem 1rem;
                font-size: 1.1rem;
            }
        }
        
        /* Additional dark theme styles */
        .progress-status {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Custom scrollbar for dark theme */
        .tz-preview::-webkit-scrollbar {
            width: 8px;
        }
        
        .tz-preview::-webkit-scrollbar-track {
            background: rgba(51, 51, 51, 0.3);
            border-radius: 4px;
        }
        
        .tz-preview::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
        }
        
        .tz-preview::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
        }
        
        /* Checkbox custom styling */
        .checkbox-item input[type="checkbox"] {
            accent-color: var(--accent-primary);
        }
        
        /* Back button in header */
        .back-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .back-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
    </style>
</head>
<body>
    <div class="tz-generator">
        <div class="tz-container">
            <!-- Header -->
            <div class="tz-header">
                <a href="index.html" class="back-btn">← Назад на главную</a>
                <h1 class="tz-title">🚀 Генератор ТЗ</h1>
                <p class="tz-subtitle">Создайте профессиональное техническое задание за 5 минут</p>
            </div>
            
            <!-- Progress Bar -->
            <div class="tz-card">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-status">
                    Шаг <span id="currentStep">1</span> из <span id="totalSteps">6</span>
                </div>
            </div>
            
            <!-- Form Steps -->
            <div class="tz-card">
                <!-- Шаг 1: Тип проекта -->
                <div class="step active" id="step1">
                    <h2 class="step-title">1. Какой тип проекта планируете?</h2>
                    <div class="option-grid">
                        <div class="option-card" data-value="landing">
                            <div class="option-icon">🌐</div>
                            <div class="option-title">Лендинг</div>
                            <div class="option-desc">Одностраничный сайт для продажи товара/услуги</div>
                        </div>
                        <div class="option-card" data-value="website">
                            <div class="option-icon">📱</div>
                            <div class="option-title">Многостраничный сайт</div>
                            <div class="option-desc">Корпоративный сайт, блог, портфолио</div>
                        </div>
                        <div class="option-card" data-value="shop">
                            <div class="option-icon">🛒</div>
                            <div class="option-title">Интернет-магазин</div>
                            <div class="option-desc">E-commerce с каталогом и корзиной</div>
                        </div>
                        <div class="option-card" data-value="app">
                            <div class="option-icon">⚙️</div>
                            <div class="option-title">Веб-приложение</div>
                            <div class="option-desc">CRM, система управления, платформа</div>
                        </div>
                    </div>
                </div>
                
                <!-- Шаг 2: Описание проекта -->
                <div class="step" id="step2">
                    <h2 class="step-title">2. Расскажите о своем проекте</h2>
                    <div class="form-group">
                        <label class="form-label">Название проекта *</label>
                        <input type="text" class="form-input" id="projectName" placeholder="Например: Интернет-магазин одежды" required minlength="3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Описание проекта *</label>
                        <textarea class="form-textarea" id="projectDescription" placeholder="Опишите что должен делать сайт, какие задачи решать, кто ваша аудитория..." required minlength="10"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ссылки на конкурентов (необязательно)</label>
                        <textarea class="form-textarea" id="competitors" placeholder="Перечислите сайты конкурентов или примеры, которые вам нравятся"></textarea>
                    </div>
                </div>
                
                <!-- Шаг 3: Целевая аудитория -->
                <div class="step" id="step3">
                    <h2 class="step-title">3. Кто ваша целевая аудитория?</h2>
                    <div class="form-group">
                        <label class="form-label">Возраст аудитории *</label>
                        <select class="form-select" id="targetAge">
                            <option value="">Выберите возрастную группу</option>
                            <option value="18-25">18-25 лет (студенты, молодые специалисты)</option>
                            <option value="25-35">25-35 лет (молодые семьи, карьеристы)</option>
                            <option value="35-45">35-45 лет (среднего возраста, устоявшиеся)</option>
                            <option value="45+">45+ лет (зрелая аудитория)</option>
                            <option value="mixed">Смешанная аудитория</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Уровень технической грамотности *</label>
                        <select class="form-select" id="techLevel">
                            <option value="">Выберите уровень</option>
                            <option value="low">Низкий (простой интерфейс, минимум функций)</option>
                            <option value="medium">Средний (стандартный функционал)</option>
                            <option value="high">Высокий (сложные функции, много возможностей)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Основные потребности пользователей</label>
                        <textarea class="form-textarea" id="userNeeds" placeholder="Что пользователи хотят получить от сайта? Какие проблемы решить?"></textarea>
                    </div>
                </div>
                
                <!-- Шаг 4: Функциональность -->
                <div class="step" id="step4">
                    <h2 class="step-title">4. Какой функционал нужен?</h2>
                    <p style="margin-bottom: 1rem; color: #666;">Отметьте нужные функции:</p>
                    <div class="checkbox-group" id="functionalityList">
                        <!-- Базовые функции -->
                        <div class="checkbox-item">
                            <input type="checkbox" id="responsive" value="responsive">
                            <label for="responsive">Адаптивная верстка (мобильные)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="seo" value="seo">
                            <label for="seo">SEO оптимизация</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analytics" value="analytics">
                            <label for="analytics">Счетчики аналитики</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="contact-form" value="contact-form">
                            <label for="contact-form">Форма обратной связи</label>
                        </div>
                    </div>
                </div>
                
                <!-- Шаг 5: Дизайн и требования -->
                <div class="step" id="step5">
                    <h2 class="step-title">5. Дизайн и технические требования</h2>
                    <div class="form-group">
                        <label class="form-label">Стиль дизайна *</label>
                        <select class="form-select" id="designStyle">
                            <option value="">Выберите стиль</option>
                            <option value="modern">Современный (минимализм, чистые линии)</option>
                            <option value="corporate">Корпоративный (строгий, деловой)</option>
                            <option value="creative">Креативный (яркий, необычный)</option>
                            <option value="classic">Классический (традиционный, консервативный)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Цветовые предпочтения</label>
                        <input type="text" class="form-input" id="colorPrefs" placeholder="Например: синий, белый, корпоративные цвета">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Есть ли логотип и фирменный стиль?</label>
                        <select class="form-select" id="branding">
                            <option value="">Выберите вариант</option>
                            <option value="yes">Да, есть готовый фирменный стиль</option>
                            <option value="partial">Есть логотип, но нет фирменного стиля</option>
                            <option value="no">Нет, нужно создать с нуля</option>
                        </select>
                    </div>
                </div>
                
                <!-- Шаг 6: Бюджет и сроки -->
                <div class="step" id="step6">
                    <h2 class="step-title">6. Бюджет и временные рамки</h2>
                    <div class="form-group">
                        <label class="form-label">Планируемый бюджет *</label>
                        <select class="form-select" id="budget">
                            <option value="">Выберите диапазон</option>
                            <option value="small">50€ - 150€ (простой проект)</option>
                            <option value="medium">150€ - 400€ (средний проект)</option>
                            <option value="large">400€ - 800€ (сложный проект)</option>
                            <option value="enterprise">800€+ (корпоративный уровень)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Когда нужно завершить проект? *</label>
                        <select class="form-select" id="deadline">
                            <option value="">Выберите срок</option>
                            <option value="urgent">Срочно (1-2 недели)</option>
                            <option value="normal">Стандартно (1-2 месяца)</option>
                            <option value="relaxed">Без спешки (2-3 месяца)</option>
                            <option value="flexible">Гибкие сроки</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Дополнительные требования</label>
                        <textarea class="form-textarea" id="additionalReqs" placeholder="Особые пожелания, ограничения, важные детали..."></textarea>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="navigation">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">Назад</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Далее</button>
                </div>
            </div>
            
            <!-- Result Section -->
            <div class="result-section" id="resultSection">
                <div class="tz-card">
                    <h2 style="text-align: center; margin-bottom: 2rem;">✅ Ваше техническое задание готово!</h2>
                    
                    <div class="tz-preview" id="tzPreview">
                        <!-- Generated TZ content will be here -->
                    </div>
                    
                    <div class="tz-export">
                        <div class="export-buttons">
                            <button class="btn btn-primary" onclick="downloadPDF()">📄 Скачать PDF</button>
                            <button class="btn btn-secondary" onclick="copyToClipboard()">📋 Копировать текст</button>
                            <button class="btn btn-secondary" onclick="startOver()">🔄 Создать новое ТЗ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Lazy loading для jsPDF
        let jsPDFLoaded = false;
        
        function loadJsPDF() {
            return new Promise((resolve, reject) => {
                if (jsPDFLoaded) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = () => {
                    jsPDFLoaded = true;
                    resolve();
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Единая система ценообразования
        const PRICING_CONFIG = {
            // Базовые цены проектов
            projectTypes: {
                'landing': { min: 50, max: 150, name: 'Лендинг' },
                'website': { min: 100, max: 300, name: 'Многостраничный сайт' },
                'shop': { min: 200, max: 500, name: 'Интернет-магазин' },
                'app': { min: 300, max: 800, name: 'Веб-приложение' }
            },
            
            // Дополнительные услуги
            features: {
                'admin': { cost: 25, name: 'Админ-панель' },
                'auth': { cost: 20, name: 'Авторизация' },
                'api': { cost: 25, name: 'API интеграция' },
                'seo': { cost: 25, name: 'SEO оптимизация' },
                'responsive': { cost: 0, name: 'Адаптивная верстка' },
                'analytics': { cost: 10, name: 'Системы аналитики' },
                'contact-form': { cost: 5, name: 'Форма обратной связи' }
            },
            
            // Диапазоны бюджета
            budgetRanges: {
                'small': '50€ - 150€',
                'medium': '150€ - 400€', 
                'large': '400€ - 800€',
                'enterprise': '800€+'
            },
            
            // Функция для получения стоимости проекта
            calculateProjectCost: function(projectType, features = []) {
                let baseCost = this.projectTypes[projectType]?.min || 0;
                let additionalCost = features.reduce((sum, feature) => {
                    return sum + (this.features[feature]?.cost || 0);
                }, 0);
                return baseCost + additionalCost;
            },
            
            // Функция для определения диапазона бюджета
            getBudgetRange: function(totalCost) {
                if (totalCost <= 150) return 'small';
                if (totalCost <= 400) return 'medium';
                if (totalCost <= 800) return 'large';
                return 'enterprise';
            }
        };

        // Fallback if jsPDF doesn't load
        if (typeof window.jspdf === 'undefined') {
            console.warn('jsPDF не загружен, PDF экспорт недоступен');
        }
    </script>
    <script>
        // State management
        let currentStepIndex = 1;
        const totalSteps = 6;
        const formData = {};
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updateFunctionalityBasedOnType();
            initializeFormEffects();
        });
        
        // Улучшенные эффекты для форм
        function initializeFormEffects() {
            // Анимация для select элементов
            const selects = document.querySelectorAll('.form-select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    // Добавляем эффект загрузки
                    this.classList.add('loading');
                    setTimeout(() => {
                        this.classList.remove('loading');
                    }, 500);
                    
                    // Эффект "пульсации" при выборе
                    this.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
                
                // Звуковая обратная связь (визуальная)
                select.addEventListener('focus', function() {
                    this.style.boxShadow = '0 0 30px rgba(102, 126, 234, 0.6)';
                });
                
                select.addEventListener('blur', function() {
                    this.style.boxShadow = '';
                });
            });
            
            // Анимация для inputs и textarea
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('focused');
                });
                
                // Эффект печати с валидацией
                input.addEventListener('input', function() {
                    this.style.borderColor = 'var(--accent-primary)';
                    clearTimeout(this.timer);
                    this.timer = setTimeout(() => {
                        this.style.borderColor = '';
                        validateField(this);
                    }, 300);
                });
            });
        }
        
        // Валидация полей в реальном времени
        function validateField(field) {
            field.classList.remove('valid', 'invalid');
            
            if (field.hasAttribute('required')) {
                if (field.value.trim() === '') {
                    field.classList.add('invalid');
                    return false;
                }
            }
            
            // Специфичная валидация
            if (field.type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (field.value && !emailRegex.test(field.value)) {
                    field.classList.add('invalid');
                    return false;
                }
            }
            
            if (field.minLength && field.value.length > 0 && field.value.length < field.minLength) {
                field.classList.add('invalid');
                return false;
            }
            
            if (field.value.trim() !== '') {
                field.classList.add('valid');
            }
            
            return true;
        }
        
        // Step navigation
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStepIndex < totalSteps) {
                    document.getElementById(`step${currentStepIndex}`).classList.remove('active');
                    currentStepIndex++;
                    document.getElementById(`step${currentStepIndex}`).classList.add('active');
                    updateProgress();
                    updateNavigation();
                    
                    if (currentStepIndex === 4) {
                        updateFunctionalityBasedOnType();
                    }
                } else {
                    generateTZ();
                }
            }
        }
        
        function previousStep() {
            if (currentStepIndex > 1) {
                document.getElementById(`step${currentStepIndex}`).classList.remove('active');
                currentStepIndex--;
                document.getElementById(`step${currentStepIndex}`).classList.add('active');
                updateProgress();
                updateNavigation();
            }
        }
        
        function updateProgress() {
            const progress = (currentStepIndex / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStepIndex;
            document.getElementById('totalSteps').textContent = totalSteps;
        }
        
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentStepIndex > 1 ? 'block' : 'none';
            nextBtn.textContent = currentStepIndex === totalSteps ? 'Создать ТЗ' : 'Далее';
        }
        
        // Validation
        function validateCurrentStep() {
            switch(currentStepIndex) {
                case 1:
                    const projectType = document.querySelector('.option-card.selected');
                    if (!projectType) {
                        alert('Выберите тип проекта');
                        return false;
                    }
                    formData.projectType = projectType.dataset.value;
                    break;
                    
                case 2:
                    const name = document.getElementById('projectName').value.trim();
                    const desc = document.getElementById('projectDescription').value.trim();
                    if (!name || !desc) {
                        alert('Заполните название и описание проекта');
                        return false;
                    }
                    formData.projectName = name;
                    formData.projectDescription = desc;
                    formData.competitors = document.getElementById('competitors').value.trim();
                    break;
                    
                case 3:
                    const age = document.getElementById('targetAge').value;
                    const tech = document.getElementById('techLevel').value;
                    if (!age || !tech) {
                        alert('Укажите возраст и технический уровень аудитории');
                        return false;
                    }
                    formData.targetAge = age;
                    formData.techLevel = tech;
                    formData.userNeeds = document.getElementById('userNeeds').value.trim();
                    break;
                    
                case 4:
                    const features = [];
                    document.querySelectorAll('#functionalityList input:checked').forEach(cb => {
                        features.push(cb.value);
                    });
                    formData.features = features;
                    break;
                    
                case 5:
                    const style = document.getElementById('designStyle').value;
                    if (!style) {
                        alert('Выберите стиль дизайна');
                        return false;
                    }
                    formData.designStyle = style;
                    formData.colorPrefs = document.getElementById('colorPrefs').value.trim();
                    formData.branding = document.getElementById('branding').value;
                    break;
                    
                case 6:
                    const budget = document.getElementById('budget').value;
                    const deadline = document.getElementById('deadline').value;
                    if (!budget || !deadline) {
                        alert('Укажите бюджет и сроки');
                        return false;
                    }
                    formData.budget = budget;
                    formData.deadline = deadline;
                    formData.additionalReqs = document.getElementById('additionalReqs').value.trim();
                    break;
            }
            return true;
        }
        
        // Option selection
        document.addEventListener('click', function(e) {
            if (e.target.closest('.option-card')) {
                const card = e.target.closest('.option-card');
                const container = card.parentElement;
                container.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            }
        });
        
        // Dynamic functionality based on project type
        function updateFunctionalityBasedOnType() {
            const functionalityList = document.getElementById('functionalityList');
            const projectType = formData.projectType;
            
            // Clear existing checkboxes except base ones
            const baseCheckboxes = functionalityList.innerHTML;
            
            let additionalFeatures = [];
            
            switch(projectType) {
                case 'landing':
                    additionalFeatures = [
                        {id: 'animations', value: 'animations', label: 'Анимации и параллакс'},
                        {id: 'popup', value: 'popup', label: 'Всплывающие окна'},
                        {id: 'countdown', value: 'countdown', label: 'Таймер обратного отсчета'},
                        {id: 'testimonials', value: 'testimonials', label: 'Отзывы клиентов'}
                    ];
                    break;
                case 'website':
                    additionalFeatures = [
                        {id: 'blog', value: 'blog', label: 'Блог/новости'},
                        {id: 'gallery', value: 'gallery', label: 'Галерея изображений'},
                        {id: 'multilang', value: 'multilang', label: 'Многоязычность'},
                        {id: 'search', value: 'search', label: 'Поиск по сайту'}
                    ];
                    break;
                case 'shop':
                    additionalFeatures = [
                        {id: 'catalog', value: 'catalog', label: 'Каталог товаров'},
                        {id: 'cart', value: 'cart', label: 'Корзина покупок'},
                        {id: 'payment', value: 'payment', label: 'Система оплаты'},
                        {id: 'orders', value: 'orders', label: 'Управление заказами'},
                        {id: 'inventory', value: 'inventory', label: 'Учет остатков'}
                    ];
                    break;
                case 'app':
                    additionalFeatures = [
                        {id: 'auth', value: 'auth', label: 'Авторизация пользователей'},
                        {id: 'admin', value: 'admin', label: 'Админ панель'},
                        {id: 'dashboard', value: 'dashboard', label: 'Дашборд с графиками'},
                        {id: 'api', value: 'api', label: 'API для интеграций'},
                        {id: 'notifications', value: 'notifications', label: 'Уведомления'}
                    ];
                    break;
            }
            
            // Add additional features
            additionalFeatures.forEach(feature => {
                const item = document.createElement('div');
                item.className = 'checkbox-item';
                item.innerHTML = `
                    <input type="checkbox" id="${feature.id}" value="${feature.value}">
                    <label for="${feature.id}">${feature.label}</label>
                `;
                functionalityList.appendChild(item);
            });
        }
        
        // Generate TZ
        function generateTZ() {
            const tzHtml = generateTZContent();
            document.getElementById('tzPreview').innerHTML = tzHtml;
            
            // Hide form and show result
            document.querySelector('.tz-card').style.display = 'none';
            document.getElementById('resultSection').classList.add('active');
        }
        
        function generateTZContent() {
            const projectTypes = {
                'landing': 'Лендинг-страница',
                'website': 'Многостраничный сайт',
                'shop': 'Интернет-магазин',
                'app': 'Веб-приложение'
            };
            
            const designStyles = {
                'modern': 'Современный минимализм',
                'corporate': 'Корпоративный стиль',
                'creative': 'Креативный дизайн',
                'classic': 'Классический стиль'
            };
            
            const budgetRanges = PRICING_CONFIG.budgetRanges;
            
            return `
                <h1 style="color: var(--text-primary); border-bottom: 2px solid var(--accent-primary); padding-bottom: 1rem;">
                    Техническое задание: ${formData.projectName}
                </h1>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">1. Общая информация</h2>
                <p><strong>Тип проекта:</strong> ${projectTypes[formData.projectType]}</p>
                <p><strong>Описание:</strong> ${formData.projectDescription}</p>
                ${formData.competitors ? `<p><strong>Конкуренты/примеры:</strong> ${formData.competitors}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">2. Целевая аудитория</h2>
                <p><strong>Возраст:</strong> ${formData.targetAge}</p>
                <p><strong>Технический уровень:</strong> ${formData.techLevel}</p>
                ${formData.userNeeds ? `<p><strong>Потребности пользователей:</strong> ${formData.userNeeds}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">3. Функциональные требования</h2>
                <ul>
                    ${formData.features.map(feature => `<li>${getFeatureName(feature)}</li>`).join('')}
                </ul>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">4. Дизайн-требования</h2>
                <p><strong>Стиль:</strong> ${designStyles[formData.designStyle]}</p>
                ${formData.colorPrefs ? `<p><strong>Цветовые предпочтения:</strong> ${formData.colorPrefs}</p>` : ''}
                ${formData.branding ? `<p><strong>Фирменный стиль:</strong> ${getBrandingText(formData.branding)}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">5. Технические требования</h2>
                <ul>
                    <li>Адаптивная верстка для всех устройств</li>
                    <li>Кроссбраузерная совместимость</li>
                    <li>Оптимизация скорости загрузки</li>
                    <li>SEO-оптимизация</li>
                    <li>Безопасность и защита данных</li>
                </ul>
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">6. Бюджет и сроки</h2>
                <p><strong>Планируемый бюджет:</strong> ${budgetRanges[formData.budget]}</p>
                <p><strong>Расчетная стоимость:</strong> ${PRICING_CONFIG.calculateProjectCost(formData.projectType, formData.features)}€ (базовая цена без дополнительных сложностей)</p>
                <div style="margin: 1rem 0; padding: 1rem; background: rgba(102, 126, 234, 0.1); border-radius: 8px; font-size: 0.9rem;">
                    <strong>Расчет:</strong> Базовая стоимость ${PRICING_CONFIG.projectTypes[formData.projectType]?.name}: ${PRICING_CONFIG.projectTypes[formData.projectType]?.min}€${formData.features.length > 0 ? ' + дополнительные функции: ' + formData.features.map(f => PRICING_CONFIG.features[f]?.cost || 0).filter(c => c > 0).join('€ + ') + '€' : ''}
                </div>
                <p><strong>Сроки:</strong> ${getDeadlineText(formData.deadline)}</p>
                ${formData.additionalReqs ? `<p><strong>Дополнительные требования:</strong> ${formData.additionalReqs}</p>` : ''}
                
                <h2 style="color: var(--accent-primary); margin-top: 2rem;">7. Результат</h2>
                <p>По итогам работы заказчик получит:</p>
                <ul>
                    <li>Полностью готовый к работе ${projectTypes[formData.projectType].toLowerCase()}</li>
                    <li>Исходный код проекта</li>
                    <li>Документацию по управлению</li>
                    <li>Техническую поддержку в течение месяца</li>
                </ul>
                
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-primary);">
                    <p style="margin: 0;"><strong>Документ создан:</strong> ${new Date().toLocaleDateString('ru-RU')}</p>
                    <p style="margin: 0;"><strong>Генератор ТЗ:</strong> TechPortal</p>
                </div>
            `;
        }
        
        function getFeatureName(feature) {
            // Расширенные названия для дополнительных функций
            const extendedNames = {
                'animations': 'Анимации и параллакс эффекты',
                'popup': 'Всплывающие окна',
                'countdown': 'Таймер обратного отсчета',
                'testimonials': 'Система отзывов',
                'blog': 'Блог/система новостей',
                'gallery': 'Галерея изображений',
                'multilang': 'Многоязычная поддержка',
                'search': 'Поиск по сайту',
                'catalog': 'Каталог товаров',
                'cart': 'Корзина покупок',
                'payment': 'Система онлайн-оплаты',
                'orders': 'Управление заказами',
                'inventory': 'Система учета остатков',
                'dashboard': 'Дашборд с аналитикой',
                'notifications': 'Система уведомлений'
            };
            
            return PRICING_CONFIG.features[feature]?.name || extendedNames[feature] || feature;
        }
        
        function getBrandingText(branding) {
            const texts = {
                'yes': 'Есть готовый фирменный стиль',
                'partial': 'Есть логотип, нужно доработать фирменный стиль',
                'no': 'Нужно создать с нуля'
            };
            return texts[branding] || branding;
        }
        
        function getDeadlineText(deadline) {
            const texts = {
                'urgent': 'Срочно (1-2 недели)',
                'normal': 'Стандартные сроки (1-2 месяца)',
                'relaxed': 'Без спешки (2-3 месяца)',
                'flexible': 'Гибкие сроки'
            };
            return texts[deadline] || deadline;
        }
        
        // Export functions
        async function downloadPDF() {
            // Показываем индикатор загрузки
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '⏳ Загружаем PDF...';
            btn.disabled = true;
            
            try {
                await loadJsPDF();
                
                if (typeof window.jspdf === 'undefined') {
                    throw new Error('jsPDF не загружен');
                }
            } catch (error) {
                alert('Ошибка загрузки PDF библиотеки. Попробуйте скопировать текст.');
                btn.textContent = originalText;
                btn.disabled = false;
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configure for Russian text
            doc.setFont('helvetica');
            
            let yPosition = 20;
            const lineHeight = 7;
            const pageHeight = 280;
            
            // Title
            doc.setFontSize(16);
            doc.text(`Техническое задание: ${formData.projectName}`, 20, yPosition);
            yPosition += lineHeight * 2;
            
            // Content sections
            const content = [
                {
                    title: '1. Общая информация',
                    items: [
                        `Тип проекта: ${getProjectTypeName(formData.projectType)}`,
                        `Описание: ${formData.projectDescription}`,
                        formData.competitors ? `Конкуренты: ${formData.competitors}` : null
                    ]
                },
                {
                    title: '2. Целевая аудитория',
                    items: [
                        `Возраст: ${formData.targetAge}`,
                        `Технический уровень: ${formData.techLevel}`,
                        formData.userNeeds ? `Потребности: ${formData.userNeeds}` : null
                    ]
                },
                {
                    title: '3. Функциональность',
                    items: formData.features.map(f => getFeatureName(f))
                },
                {
                    title: '4. Дизайн',
                    items: [
                        `Стиль: ${getDesignStyleName(formData.designStyle)}`,
                        formData.colorPrefs ? `Цвета: ${formData.colorPrefs}` : null,
                        formData.branding ? `Фирменный стиль: ${getBrandingText(formData.branding)}` : null
                    ]
                },
                {
                    title: '5. Бюджет и сроки',
                    items: [
                        `Бюджет: ${getBudgetText(formData.budget)}`,
                        `Сроки: ${getDeadlineText(formData.deadline)}`,
                        formData.additionalReqs ? `Дополнительно: ${formData.additionalReqs}` : null
                    ]
                }
            ];
            
            doc.setFontSize(12);
            
            content.forEach(section => {
                // Check if we need a new page
                if (yPosition > pageHeight - 40) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Section title
                doc.setFont('helvetica', 'bold');
                doc.text(section.title, 20, yPosition);
                yPosition += lineHeight;
                
                // Section items
                doc.setFont('helvetica', 'normal');
                section.items.forEach(item => {
                    if (item) {
                        // Handle long text wrapping
                        const splitText = doc.splitTextToSize(item, 170);
                        splitText.forEach(line => {
                            if (yPosition > pageHeight - 20) {
                                doc.addPage();
                                yPosition = 20;
                            }
                            doc.text(line, 25, yPosition);
                            yPosition += lineHeight;
                        });
                    }
                });
                yPosition += lineHeight;
            });
            
            // Save PDF
            doc.save(`TZ_${formData.projectName.replace(/[^a-zа-я0-9]/gi, '_')}.pdf`);
            
            // Восстанавливаем кнопку
            btn.textContent = originalText;
            btn.disabled = false;
        }
        
        function copyToClipboard() {
            const tzText = document.getElementById('tzPreview').innerText;
            navigator.clipboard.writeText(tzText).then(() => {
                alert('Техническое задание скопировано в буфер обмена!');
            }).catch(() => {
                alert('Ошибка копирования. Попробуйте выделить текст вручную.');
            });
        }
        
        function startOver() {
            if (confirm('Вы уверены, что хотите создать новое ТЗ? Текущий прогресс будет потерян.')) {
                location.reload();
            }
        }
        
        // Helper functions for PDF
        function getProjectTypeName(type) {
            return PRICING_CONFIG.projectTypes[type]?.name || type;
        }
        
        function getDesignStyleName(style) {
            const styles = {
                'modern': 'Современный минимализм',
                'corporate': 'Корпоративный стиль',
                'creative': 'Креативный дизайн',
                'classic': 'Классический стиль'
            };
            return styles[style] || style;
        }
        
        function getBudgetText(budget) {
            return PRICING_CONFIG.budgetRanges[budget] || budget;
        }
    </script>
    
    <!-- Essential modules -->
    <script src="js/security.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/forms.js"></script>
    <script>
        // Initialize modules for TZ generator
        if (window.SecurityModule) {
            SecurityModule.initSecurity();
        }
        if (window.UtilsModule) {
            UtilsModule.initUtils();
        }
        if (window.FormsModule) {
            FormsModule.initForms();
        }
    </script>
</body>
</html> 